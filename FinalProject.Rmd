---
title: "Final Project"
output: html_document
date: "2025-02-26"

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(naniar)
library(ggmap)
```

```{r}
options(scipen = 999)
```


## Load the Data
```{r}
cardiac <- read_csv("data/cardiac-surgery.csv") %>% clean_names()
```

```{r}
glimpse(cardiac)
```

## Cleaning the Data
```{r}
cardiac <- cardiac %>% 
  mutate(year_of_hospital_discharge = as.factor(year_of_hospital_discharge)) %>% 
  mutate(facility_id = as.factor(facility_id))
```

```{r}
cardiac <- cardiac %>% 
  mutate(across(everything(), tolower))
cardiac
```

```{r}
cardiac <- cardiac %>%
  mutate(across(everything(), tolower)) %>% 
  mutate(across(everything(), ~ str_replace_all((.), " ", "_"))) %>% 
  mutate(across(everything(), ~ str_replace_all((.), "__", "_"))) %>% 
  mutate(across(-year_of_hospital_discharge, ~ str_remove((.), "-")))
cardiac
```

Have to separate the data, as some of them are over a range of a couple of years, some of them are year by year
```{r}
sites_with_ranges <- cardiac %>%
  filter(str_detect(year_of_hospital_discharge, "-", negate = FALSE))

sites_per_year <- cardiac %>% 
  filter(str_detect(year_of_hospital_discharge, "-", negate = TRUE))
```


## Plots

What is the procedure with the highest observed mortality rate?
```{r}
cardiac %>% 
  group_by(procedure) %>% 
  summarize(avg_mortality = mean(observed_mortality_rate)) %>% 
  arrange(-avg_mortality)
```

```{r}
cardiac %>% 
  group_by(procedure) %>% 
  summarize(avg_mortality = mean(observed_mortality_rate)) %>% 
  ggplot(aes(x = reorder(procedure, avg_mortality), y = avg_mortality))+
  geom_col(color = "black", fill = "lightblue")+
  coord_flip()+
  labs(title = "Average Observed Mortality Rate by Procedure",
       x = "Procedure",
       y = "Mortality Rate")+
  theme_light(base_size = 12)
```


How has the mortality rate changed for cardiac surgery over time in each region?
```{r}
#I'll come back to this later if I figure out the year stuff but feel free to take a crack at it :)
```


How does the expected mortality rate compare to the observed mortality rate?
```{r}
#I don't know which graph to plot for this one but if you can figure it out that would be great. I was thinking maybe scatter but I don't know for sure
```


Which region has the highest mortality rate?
```{r}
cardiac %>% 
  group_by(region) %>% 
  summarize(avg_mortality = mean(observed_mortality_rate)) %>% 
  arrange(-avg_mortality)
```

```{r}
cardiac %>% 
  group_by(region) %>% 
  summarize(avg_mortality = mean(observed_mortality_rate)) %>% 
  ggplot(aes(x = reorder(region, avg_mortality), y = avg_mortality))+
  geom_col(color = "black", fill = "lightpink")+
  coord_flip()+
  labs(title = "Average Observed Mortality Rate per Region",
       x = "Region",
       y = "Mortality Rate")+
  theme_light(base_size = 12)
```

It would be cool to plot these hospitals on a map but we would need coordinates for that :,)

## Shiny App
```{r}

```

